---
/**
 * Categories Section - Iris Muebles
 * 
 * Grid de categorias con estilo minimalista
 * Colores naranja y neutros para consistencia de marca
 */
import { categoriasApi, productosApi } from "../../lib/api";

// Fetch categories from the API
const categorias = await categoriasApi.getAll();

// Category icons (SVG paths)
const categoryIcons: Record<string, string> = {
  sofas: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />`,
  sillas: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />`,
  mesas: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />`,
  camas: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />`,
  estanterias: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />`,
};

const categoryDescriptions: Record<string, string> = {
  sofas: "Comodidad para tu living",
  sillas: "Estilo y ergonomia",
  mesas: "El centro de reunion",
  camas: "Descanso perfecto",
  estanterias: "Organizacion con estilo",
};

// Fetch product counts for each category
const categoriesWithCounts = await Promise.all(
  categorias.map(async (cat, index) => {
    try {
      const productos = await productosApi.getAll({ 
        categoria_id: cat.id,
        activo: true 
      });
      const slug = cat.nombre.toLowerCase();
      return {
        name: cat.nombre,
        slug: slug,
        description: categoryDescriptions[slug] || cat.descripcion || "Ver productos",
        productCount: productos.length,
        icon: categoryIcons[slug] || categoryIcons.sofas,
      };
    } catch (error) {
      const slug = cat.nombre.toLowerCase();
      return {
        name: cat.nombre,
        slug: slug,
        description: categoryDescriptions[slug] || cat.descripcion || "Ver productos",
        productCount: 0,
        icon: categoryIcons[slug] || categoryIcons.sofas,
      };
    }
  })
);

const categories = categoriesWithCounts;
---

<section class="py-20 bg-gray-50">
  <div class="container">
    <!-- Section Header -->
    <div class="text-center max-w-2xl mx-auto mb-16">
      <span class="inline-block px-4 py-1.5 bg-orange-100 text-orange-600 text-sm font-medium rounded-full mb-4">
        Categorias
      </span>
      <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
        Explora por Categoria
      </h2>
      <p class="text-gray-600 text-lg">
        Encuentra exactamente lo que buscas navegando nuestras categorias
      </p>
    </div>

    <!-- Categories Grid -->
    <div class="flex justify-center">
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 lg:gap-6 w-full max-w-6xl">
        {
          categories.map((category) => (
            <a
              href={`/catalogo?categoria=${category.slug}`}
              class="bg-white rounded-2xl p-6 text-center border border-gray-100"
            >
              {/* Icon */}
              <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 text-gray-600 rounded-xl flex items-center justify-center">
                <svg
                  class="w-8 h-8"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  set:html={category.icon}
                />
              </div>
              
              {/* Content */}
              <h3 class="text-lg font-semibold text-gray-900 mb-1">
                {category.name}
              </h3>
              <p class="text-sm text-gray-500 mb-3">{category.description}</p>
              
              {/* Product count badge */}
              <span class="inline-flex items-center gap-1 text-xs font-medium text-orange-600 bg-orange-50 px-3 py-1 rounded-full">
                {category.productCount} productos
              </span>
            </a>
          ))
        }
      </div>
    </div>
  </div>
</section>
