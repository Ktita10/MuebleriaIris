---
import Layout from "../../layouts/Layout.astro";
import CatalogContainer from "../../components/catalog/CatalogContainer";

// Get query params
const categoria = Astro.url.searchParams.get("categoria");

// Categories for filtering
const categories = [
  { slug: "sofas", name: "Sofas" },
  { slug: "sillas", name: "Sillas" },
  { slug: "mesas", name: "Mesas" },
  { slug: "camas", name: "Camas" },
  { slug: "estanterias", name: "Estanterias" },
];

// Icons for each category
const categoryIcons = {
  sofas: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6',
  sillas: 'M7 8h10M7 8v8a2 2 0 01-2 2H4m3-10V5a2 2 0 012-2h6a2 2 0 012 2v3m0 0v8a2 2 0 002 2h1m-3-10h3',
  mesas: 'M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z',
  camas: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6',
  estanterias: 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10'
};

// Page title based on category
const pageTitle = categoria
  ? `${categories.find((c) => c.slug === categoria)?.name || "Catálogo"} - Iris Muebles`
  : "Catálogo - Iris Muebles";
---

<Layout title={pageTitle} description="Explora nuestra coleccion completa de muebles de alta calidad.">
  <section class="section bg-gray-50">
    <div class="container">
      <!-- Page Header -->
      <div class="mb-8">
        <nav class="text-sm text-gray-500 mb-4">
          <a href="/" class="hover:text-orange-500">Inicio</a>
          <span class="mx-2">/</span>
          <span class="text-gray-900">Catalogo</span>
          {
            categoria && (
              <>
                <span class="mx-2">/</span>
                <span class="text-gray-900 capitalize">{categoria}</span>
              </>
            )
          }
        </nav>

        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
          <div>
            <h1 class="text-3xl lg:text-4xl font-bold text-gray-900">
              {categoria ? categories.find((c) => c.slug === categoria)?.name : "Catalogo"}
            </h1>
            <p class="text-gray-600 mt-2">
              {categoria ? `Todos los productos en ${categoria}` : "Explora toda nuestra coleccion"}
            </p>
          </div>
        </div>
      </div>

      <!-- Filters Bar -->
      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8">
        <div class="flex flex-col gap-4">
          <!-- Filter Title -->
          <div class="flex items-center gap-3">
            <svg class="w-5 h-5 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
            </svg>
            <h2 class="text-lg font-semibold text-gray-900">Filtrar por categoria</h2>
          </div>
          
          <!-- Category Grid -->
          <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
            <a
              href="/catalogo"
              class={`group relative overflow-hidden rounded-xl p-4 text-center ${
                !categoria
                  ? "bg-orange-500 text-white shadow-lg shadow-orange-500/25"
                  : "bg-gray-50 text-gray-700 border border-gray-200"
              }`}
            >
              <div class="flex flex-col items-center gap-2">
                <svg class={`w-6 h-6 ${!categoria ? 'text-white' : 'text-gray-500'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
                <span class="text-sm font-medium">Todos</span>
              </div>
            </a>
            {
              categories.map((cat) => {
                const iconPath = categoryIcons[cat.slug as keyof typeof categoryIcons] || categoryIcons.sofas;
                const isActive = categoria === cat.slug;
                
                return (
                  <a
                    href={`/catalogo?categoria=${cat.slug}`}
                    class={isActive
                      ? "group relative overflow-hidden rounded-xl p-4 text-center bg-orange-500 text-white shadow-lg shadow-orange-500/25"
                      : "group relative overflow-hidden rounded-xl p-4 text-center bg-gray-50 text-gray-700 border border-gray-200"
                    }
                  >
                    <div class="flex flex-col items-center gap-2">
                      <svg class={isActive ? 'w-6 h-6 text-white' : 'w-6 h-6 text-gray-500'} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={iconPath} />
                      </svg>
                      <span class="text-sm font-medium">{cat.name}</span>
                    </div>
                  </a>
                );
              })
            }
          </div>
        </div>
      </div>

      <!-- Catalog Container with Real-time Filtering -->
      <CatalogContainer 
        client:load 
        categoria={categoria} 
      />
    </div>
  </section>
</Layout>
