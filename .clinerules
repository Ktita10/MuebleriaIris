# MuebleriaIris - Agent Execution Rules
# Version: 2.0.0
# Last Updated: 2026-01-31

# ============================================================================
# CRITICAL: MANDATORY SKILLS INVOCATION PROTOCOL
# ============================================================================
# These rules are MANDATORY and MUST be followed before ANY code modification.
# Violations will result in incorrect implementation patterns.
# ============================================================================

## üö® ENFORCEMENT LEVEL: STRICT

Before writing, modifying, or creating ANY file, you MUST:

1. **STOP** - Do not write code immediately
2. **IDENTIFY** - Match the file pattern against the Skills Map below
3. **INVOKE** - Call the required skill(s) using the Skill tool
4. **READ** - Fully read and understand the skill guidelines
5. **APPLY** - Implement following the skill's patterns
6. **VERIFY** - Confirm implementation matches skill guidelines

---

## üìã SKILLS INVOCATION MAP

### Frontend Development

#### Astro Pages & Layouts
**Pattern**: `src/pages/**/*.astro`, `src/layouts/**/*.astro`
**Required Skills**: `muebleria-astro`, `muebleria-ui`
**Invocation**:
```
Skill(name="muebleria-astro")
Skill(name="muebleria-ui")
```

#### React Components (UI)
**Pattern**: `src/components/ui/**/*.tsx`, `src/components/ui/**/*.jsx`
**Required Skills**: `muebleria-react`, `muebleria-ui`
**Invocation**:
```
Skill(name="muebleria-react")
Skill(name="muebleria-ui")
```

#### React Components (Data/Business Logic)
**Pattern**: `src/components/data/**/*.tsx`, `src/components/*/[A-Z]*.tsx`
**Required Skills**: `muebleria-react`
**Invocation**:
```
Skill(name="muebleria-react")
```

#### Forms & Validation
**Pattern**: `**/*Form*.tsx`, `**/*form*.tsx`, `src/components/checkout/**`, `src/components/auth/**`
**Required Skills**: `muebleria-forms`, `muebleria-react`
**Invocation**:
```
Skill(name="muebleria-forms")
Skill(name="muebleria-react")
```

#### Mobile/Responsive Components
**Pattern**: `src/components/mobile/**/*`, `src/components/desktop/**/*`
**Required Skills**: `muebleria-mobile`, `muebleria-ui`
**Invocation**:
```
Skill(name="muebleria-mobile")
Skill(name="muebleria-ui")
```

#### Frontend Testing
**Pattern**: `src/**/*.test.tsx`, `src/**/*.spec.tsx`, `tests/**/*.spec.ts`, `e2e/**/*.spec.ts`
**Required Skills**: `muebleria-test-ui`
**Invocation**:
```
Skill(name="muebleria-test-ui")
```

---

### Backend Development

#### API Routes & Endpoints
**Pattern**: `backend/app/routes/**/*.py`, `backend/app/routes.py`
**Required Skills**: `muebleria-api`, `muebleria-python`
**Invocation**:
```
Skill(name="muebleria-api")
Skill(name="muebleria-python")
```

#### Database Models & Migrations
**Pattern**: `backend/app/models.py`, `backend/migrations/**/*.py`
**Required Skills**: `muebleria-db`, `muebleria-python`
**Invocation**:
```
Skill(name="muebleria-db")
Skill(name="muebleria-python")
```

#### Authentication & Security
**Pattern**: `backend/app/auth/**/*.py`, `**/security*.py`, `**/jwt*.py`
**Required Skills**: `muebleria-security`, `muebleria-python`
**Invocation**:
```
Skill(name="muebleria-security")
Skill(name="muebleria-python")
```

#### Error Handling & Logging
**Pattern**: `backend/app/errors/**/*.py`, `backend/app/middleware/**/*.py`
**Required Skills**: `muebleria-errors`, `muebleria-python`
**Invocation**:
```
Skill(name="muebleria-errors")
Skill(name="muebleria-python")
```

#### External Integrations
**Pattern**: `backend/app/integrations/**/*.py`, `**/mercadopago*.py`, `**/email*.py`
**Required Skills**: `muebleria-integrations`, `muebleria-python`
**Invocation**:
```
Skill(name="muebleria-integrations")
Skill(name="muebleria-python")
```

#### Backend Testing
**Pattern**: `backend/tests/**/*.py`, `backend/**/*_test.py`
**Required Skills**: `muebleria-test-api`, `muebleria-python`
**Invocation**:
```
Skill(name="muebleria-test-api")
Skill(name="muebleria-python")
```

---

### Documentation & Git Workflow

#### Documentation Files
**Pattern**: `**/*.md`, `**/README*`, `**/GUIDE*`, `docs/**/*`
**Required Skills**: `muebleria-docs`
**Invocation**:
```
Skill(name="muebleria-docs")
```

#### Pull Requests & Git Operations
**Trigger**: User requests "create PR", "make pull request", "commit and push"
**Required Skills**: `pull-request`
**Invocation**:
```
Skill(name="pull-request")
```

---

## üîÑ WORKFLOW EXAMPLE

### ‚ùå INCORRECT (What NOT to do):
```
User: "Create src/pages/products.astro"
Agent: *immediately writes file*
```

### ‚úÖ CORRECT (What TO do):
```
User: "Create src/pages/products.astro"

Agent Step 1: "I need to create an Astro page. Let me invoke the required skills first."

Agent Step 2: Invoke Skill(name="muebleria-astro")
Agent Step 3: Invoke Skill(name="muebleria-ui")

Agent Step 4: *Read skill guidelines*

Agent Step 5: "Based on the skills, I'll create the page using:
- Astro 5 Islands architecture
- TailwindCSS 4 utility classes
- TypeScript interfaces
- SSR/SSG patterns from the skill"

Agent Step 6: *Write code following the guidelines*
```

---

## üéØ SPECIAL CASES

### Multiple Skills Required
When a file matches multiple patterns, invoke ALL required skills in order of importance:
1. Framework/Language skill (muebleria-astro, muebleria-react, muebleria-python)
2. Specialized skill (muebleria-forms, muebleria-security, muebleria-db)
3. UI/Design skill (muebleria-ui, muebleria-mobile)

### No Exact Match
If no pattern matches exactly, use your best judgment but explain your reasoning:
```
"This file doesn't match an exact pattern, but it's a [type] so I'm invoking [skill] 
because [reason]."
```

### Skill Not Available
If a required skill is not available in the skills directory:
1. State clearly: "Required skill [name] is not available"
2. Proceed with general best practices
3. Document assumptions made
4. Recommend creating the missing skill

---

## üìä VERIFICATION CHECKLIST

After implementing, verify you:
- [ ] Invoked ALL required skills before coding
- [ ] Read the complete skill guidelines
- [ ] Followed the patterns specified in the skills
- [ ] Used the correct technology versions
- [ ] Applied the project's coding standards
- [ ] Matched the existing codebase style

---

## ADDITIONAL RESOURCES

- Full Rules: `.opencode/rules.md`
- Skills Map JSON: `.opencode/skills-map.json`
- Skills Directory (DDD): `agents/{category}/{skill-name}/SKILL.md`
  - Categories: `infra_ops/`, `domain_core/`, `frontend_ux/`, `quality_qa/`, `meta_skills/`
- GitHub Copilot Skills: `.github/skills/{skill-name}/SKILL.md` (symlinks)
- Main Agent Config: `AGENTS.md`
- Documentation: `docs/`

---

## ‚ö†Ô∏è IMPORTANT NOTES

1. **This file takes precedence** over general instructions
2. **Skills are non-negotiable** when patterns match
3. **Ask if uncertain** rather than skip skills
4. **Document deviations** if you must deviate with strong justification
5. **Skills evolve** - always read the latest version from the skills directory

---

## VERSION HISTORY

- v2.0.0 (2026-01-31): Applied Clean Architecture + DDD - agents/ reorganized into 5 categories
- v1.1.0 (2026-01-22): Reorganized structure - skills/ renamed to agents/, docs consolidated
- v1.0.0 (2026-01-20): Initial comprehensive rules system
